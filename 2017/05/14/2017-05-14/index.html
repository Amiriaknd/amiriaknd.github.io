<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Vue问题笔记 · Lord Camelot</title><meta name="description" content="Vue问题笔记 - Amiria"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Lord Camelot"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">月光食堂</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="mailto:amiriaknd@outlook.com" target="_self" class="nav-list-link">MAILTOME</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Vue问题笔记</h1><div class="post-info">May 14, 2017</div><div class="post-content"><h4 id="vue-router2的变化"><a href="#vue-router2的变化" class="headerlink" title="vue-router2的变化"></a>vue-router2的变化</h4><p><code>vue-router2</code>改了<code>router.map()</code>和<code>router.start()</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</div><div class="line">    [</div><div class="line">        &#123; <span class="attr">path</span>: <span class="string">'/list'</span>, <span class="attr">component</span>: list, <span class="attr">alias</span>: <span class="string">'/'</span> &#125;,</div><div class="line">        <span class="comment">// 添加一个别名'/'来指定默认页面</span></div><div class="line">        &#123; <span class="attr">path</span>: <span class="string">'/detail'</span>, <span class="attr">component</span>: detail &#125;,</div><div class="line">        &#123; <span class="attr">path</span>: <span class="string">'/edit'</span>, <span class="attr">component</span>: edit &#125;</div><div class="line">    ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><code>router.start()</code>被弃用，现在要在配置vue对象的时候注入上面的router</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Vue(&#123;</div><div class="line">    router,</div><div class="line">    components: &#123;</div><div class="line">        app</div><div class="line">    &#125;</div><div class="line">&#125;).$mount(<span class="string">'#app'</span>)</div></pre></td></tr></table></figure>
<a id="more"></a>
<hr>
<h4 id="vuex2的变化"><a href="#vuex2的变化" class="headerlink" title="vuex2的变化"></a>vuex2的变化</h4><p>vuex2相比以前用的0.6来说改了不少，但是大部分都是一些变量名的更改，整体思路个人感觉变化不大<br>最显著的变化应该是<code>modules</code>了吧<br><code>modules</code>就是一个子<code>vuex</code>，有自己独立的<code>state</code>, <code>getters</code>, <code>mutations</code>和<code>actions</code>，除了<code>state</code>之外其他都是暴露在外部的</p>
<hr>
<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>在使用某个action的时候发现总是会有参数莫名其妙的变成<code>undefined</code>，用log打印了一下，发现在调用action的时候参数压根都没有传过去<br>比如<code>update(id, value)</code>，结果传过来的只有<code>id</code>，<code>value</code>是<code>undefined</code></p>
<p>思考了好久，突然在debug tools看到一个叫<code>payload</code>的对象，然后就想起vuex2里面好像是新加了这个设定<br>如果只有一个参数，这个参数就被js当作了<code>payload</code>，因此不会有问题<br>放进去多个参数的时候，却只有第一个参数会被当作<code>payload</code>传入<code>action</code><br>因此需要改为<code>update({id: id, value: value})</code></p>
<hr>
<h4 id="vuex和表单处理"><a href="#vuex和表单处理" class="headerlink" title="vuex和表单处理"></a>vuex和表单处理</h4><p><code>vuex</code>的官方文档中也有提到，<code>vuex</code>在和<code>v-model</code>搭配使用的时候，由于<code>v-model</code>会直接修改对象，这个修改是不在<code>mutation</code>中执行的，很容易出问题</p>
<p>官方文档给了两种解决方案，一种是为对象设置<code>getter</code>和<code>setter</code>，<code>v-model</code>更改对象的时候会调用<code>setter</code>函数，这时候<code>commit mutation</code>就可以了</p>
<p>但是如果对象是动态的话，上面的方法就不好使了。这种情况最好监听<code>input</code>或者<code>change</code>事件，不使用<code>v-model</code>，在事件的回调函数中<code>commit mutation</code></p>
<hr>
<h4 id="vue的视图更新"><a href="#vue的视图更新" class="headerlink" title="vue的视图更新"></a>vue的视图更新</h4><p>直接通过索引修改数组的话无法触发视图更新<br>比如<code>arr[index] = val</code>，数据层虽然将<code>index</code>修改为<code>val</code>，但是视图不会跟着更新，需要使用<code>vue</code>包装过的方法<code>arr.splice(index, 1, val)</code>来触发更新</p>
<p>除此之外直接修改数组的长度也会导致视图不更新，解决方法是<code>arr.splice(newLength)</code><br><code>splice</code>只接受一个参数的时候会截取至<code>index</code>为<code>newLength</code>的元素，也就是截取成<code>newLength</code>长度</p>
<hr>
<h4 id="beforeRouteEnter"><a href="#beforeRouteEnter" class="headerlink" title="beforeRouteEnter"></a>beforeRouteEnter</h4><p><code>vue-router2</code>中，导航钩子<code>beforeRouteEnter</code>可以在渲染组件的路由被<code>confirm</code>之前调用，也就是说只有这个钩子<code>resolve</code>之后才会渲染组件<br><code>beforeRouteEnter(to, from, next)</code>，<code>to</code>和<code>from</code>是路由对象，即<code>this.$route</code>，包含<code>path</code>, <code>params</code>, <code>query</code>等信息<br>值得一提的是在这个钩子中不能访问this，因为此时导航还没有被确认，组件尚未被创建，要使用this可以在<code>next</code>中添加一个回调函数<code>next()</code>来<code>resolve</code>这个钩子，<code>next(&#39;/&#39;)</code>或者<code>next({ path: &#39;/&#39; })</code>来重定向，<code>next(false)</code>来中断路由，会返回到from路由对应的地址</p>
<hr>
<h4 id="install"><a href="#install" class="headerlink" title="install"></a>install</h4><p>使用<code>install</code>注册插件，如果需要在模板中使用这个函数就在<code>data</code>中返回</p>
<hr>
</div></article></div></main><footer><div class="paginator"><a href="/2017/06/09/2017-06-09/" class="prev">PREV</a><a href="/2017/04/23/2017-04-23/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 <a href="http://yoursite.com">Amiria</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>